#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ì¢…í•© ë²ˆì—­ ë¦¬í¬íŠ¸ ìƒì„±ê¸°
ê° ì—í”¼ì†Œë“œë³„ translation_review_llm.csvì™€ translation_metrics.txtë¥¼ ìˆ˜ì§‘í•˜ì—¬
JSONìœ¼ë¡œ í†µí•©í•˜ê³  Gemini-2.5-proë¥¼ ì‚¬ìš©í•´ ì¢…í•© ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
"""

import os
import json
import csv
import pandas as pd
from datetime import datetime
from google import genai
from google.genai import types
from typing import Dict, List, Any

class ComprehensiveReportGenerator:
    def __init__(self, base_path: str, previous_feedback_path: str = None):
        """
        ë¦¬í¬íŠ¸ ìƒì„±ê¸° ì´ˆê¸°í™”
        
        Args:
            base_path: preprocessed ë””ë ‰í† ë¦¬ ê²½ë¡œ
            previous_feedback_path: ê¸°ì¡´ í”¼ë“œë°± íŒŒì¼ ê²½ë¡œ (ì„ íƒì‚¬í•­)
        """
        self.base_path = base_path
        self.previous_feedback_path = previous_feedback_path
        self.has_previous_feedback = previous_feedback_path is not None
        
        # ê¸°ì¡´ í”¼ë“œë°± ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
        if self.has_previous_feedback:
            self.system_prompt = self._get_followup_system_prompt()
        else:
            self.system_prompt = self._get_hardcoded_system_prompt()
        
        # Gemini API ì„¤ì • (í™˜ê²½ë³€ìˆ˜ì—ì„œ API í‚¤ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤)
        API_KEY = os.getenv('HACKATHON_GEMINI_API_KEY')
        if not API_KEY:
            raise ValueError("HACKATHON_GEMINI_API_KEY í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. ~/.zshrcì— 'export HACKATHON_GEMINI_API_KEY=\"your_api_key\"'ë¥¼ ì¶”ê°€í•˜ê³  'source ~/.zshrc'ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.")
        
        self.client = genai.Client(api_key=API_KEY)
        
    def _get_hardcoded_system_prompt(self) -> str:
        """ê¸°ì¡´ í”¼ë“œë°±ì´ ì—†ëŠ” ê²½ìš°ì˜ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ íŒŒì¼ì—ì„œ ì½ì–´ ë°˜í™˜í•©ë‹ˆë‹¤."""
        prompt_file_path = "../data/prompt/overall_feedback_generation_prompt_default.txt"
        try:
            with open(prompt_file_path, 'r', encoding='utf-8') as f:
                return f.read().strip()
        except FileNotFoundError:
            print(f"âš ï¸ í”„ë¡¬í”„íŠ¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {prompt_file_path}")
            print("ê¸°ë³¸ í•˜ë“œì½”ë”©ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
            return """**ì—­í• **: ë‹¹ì‹ ì€ ë²ˆì—­íŒ€ì„ ì´ê´„í•˜ëŠ” ì „ë¬¸ ë²ˆì—­ í’ˆì§ˆ ê´€ë¦¬ì(Lead Reviewer)ì…ë‹ˆë‹¤.

**ì‘ì—… ì§€ì‹œ**: ë‹¤ìŒ JSON í˜•ì‹ì˜ ì…ë ¥ ë°ì´í„°ëŠ” íŠ¹ì • ë²ˆì—­ ì‘ì—…ìê°€ ì‘ì—…í•œ ì—¬ëŸ¬ ê²°ê³¼ë¬¼ì— ëŒ€í•œ ê²€ìˆ˜ ê¸°ë¡ì…ë‹ˆë‹¤. ì´ ë°ì´í„°ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬, í•´ë‹¹ ì‘ì—…ìì˜ ì„±ê³¼ë¥¼ í‰ê°€í•˜ê³  ì„±ì¥ì„ ë•ê¸° ìœ„í•œ **ì¢…í•© í‰ê°€ ë³´ê³ ì„œ**ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

**ì…ë ¥ ë°ì´í„° í˜•ì‹**:
1.  **í†µí•© í†µê³„ íŒŒì¼**: í”„ë¡œì íŠ¸ ì „ë°˜ì˜ ì •ëŸ‰ì  ë°ì´í„°ë¥¼ ìš”ì•½í•œ íŒŒì¼ì…ë‹ˆë‹¤.
2.  **ë²ˆì—­ ê²€ìˆ˜ ë°ì´í„° (JSON ë°°ì—´)**: ê°œë³„ ë¬¸ì¥ì— ëŒ€í•œ ìˆ˜ì • ì‚¬í•­ì„ ìƒì„¸íˆ ê¸°ë¡í•œ ë°ì´í„°ì…ë‹ˆë‹¤. ì´ëŠ” translated_text(ë²ˆì—­ê°€ì˜ ë²ˆì—­ë¬¸), edited_text(ê²€ìˆ˜ìê°€ ìˆ˜ì •í•œ ë²ˆì—­ë¬¸), tag(ìˆ˜ì • íƒœê·¸), comment(ê° ìˆ˜ì •ì— ëŒ€í•œ ê²€ìˆ˜ì ì½”ë©˜íŠ¸), episode(ê° ë²ˆì—­ë¬¸ê³¼ ê²€ìˆ˜ë¬¸ì´ ì–´ë–¤ ì—í”¼ì†Œë“œì— í•´ë‹¹í•˜ëŠ”ì§€)ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤. 

**ë¶„ì„ ë° í‰ê°€ ìš”êµ¬ì‚¬í•­**:

1.  **ì •ëŸ‰ì  ë°ì´í„° ìš”ì•½**:

      * í†µí•© í†µê³„ íŒŒì¼ì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ **ì „ì²´ í†µê³„, íƒœê·¸ë³„ ë¹ˆë„ ë° ë¹„ìœ¨, ë²ˆì—­ í’ˆì§ˆ ì´ì  ë° ë“±ê¸‰, ì˜ì—­ë³„ ìƒì„¸ ì ìˆ˜**ë¥¼ ë³´ê³ ì„œì˜ 'ì •ëŸ‰ ë¶„ì„' ì„¹ì…˜ì— ì •í™•íˆ ê¸°ì¬í•©ë‹ˆë‹¤.

2.  **ì •ì„±ì  íŒ¨í„´ ë¶„ì„**:

      * **ì˜í•œ ì  (Strengths)**: ë²ˆì—­ê°€ì˜ í˜„ì¬ ê°•ì ì„ íŒŒì•…í•˜ê³  ì¹­ì°¬í•©ë‹ˆë‹¤. ìˆ˜ì •ì´ ê±°ì˜ ì—†ì—ˆê±°ë‚˜, 'ìœ¤ë¬¸' íƒœê·¸ë§Œ ì ìš©ëœ ì‚¬ë¡€ ë“± ë²ˆì—­ê°€ì˜ ê°•ì ì´ ë“œëŸ¬ë‚˜ëŠ” ë¶€ë¶„ì„ íŒŒì•…í•˜ê³  ì¹­ì°¬í•©ë‹ˆë‹¤.
      * **ê°œì„ ì  (Areas for Improvement)**: í˜„ì¬ ì‘ì—…ë¬¼ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” ì£¼ìš” ì‹¤ìˆ˜ íŒ¨í„´ì„ ë¶„ì„í•©ë‹ˆë‹¤. ê°€ì¥ ë¹ˆë²ˆí•˜ê²Œ ë‚˜íƒ€ë‚œ íƒœê·¸ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ, ë²ˆì—­ê°€ì˜ ì£¼ìš” ì‹¤ìˆ˜ íŒ¨í„´ì„ ë¶„ì„í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ë¬¸ë²• ì˜¤ë¥˜ê°€ ë°˜ë³µë˜ëŠ”ì§€, ìš©ì–´ì§‘ ì¤€ìˆ˜ìœ¨ì´ ë‚®ì€ì§€ ë“±ì„ íŒŒì•…í•©ë‹ˆë‹¤.
      * ë¶„ì„ ì‹œ, ë°˜ë“œì‹œ ì…ë ¥ ë°ì´í„°ì—ì„œ **êµ¬ì²´ì ì¸ ì˜ˆì‹œ(`translated_text` â†’ `edited_text`)ì™€ ì—í”¼ì†Œë“œ í™”ìˆ˜ë¥¼ 2-3ê°œ ì´ìƒ ì¸ìš©**í•˜ì—¬ ê·¼ê±°ë¥¼ ëª…í™•íˆ ì œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

3.  **ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ì‹ë³„ (Critical Issues)**:

      * 'ì˜¤ì—­'ê³¼ ê°™ì´ ì›ë¬¸ì˜ ì˜ë¯¸ë¥¼ ì‹¬ê°í•˜ê²Œ í›¼ì†í•œ ì‚¬ë¡€ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
      * '[ê°€ì´ë“œ ì¤€ìˆ˜] ì„¤ì •ì§‘ ë°˜ì˜' ë“± í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ê°€ì´ë“œë¼ì¸ì„ ë°˜ë³µì ìœ¼ë¡œ ìœ„ë°˜í•œ ì‚¬ë¡€ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
      * ì´ëŸ¬í•œ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ëŠ” ë³„ë„ë¡œ ë¶„ë¥˜í•˜ì—¬ ëª…í™•í•˜ê²Œ ì§€ì í•´ì•¼ í•©ë‹ˆë‹¤.

4.  **ì¢…í•© ì˜ê²¬ ë° ì œì–¸ (Overall Summary & Recommendations)**:

      * ìœ„ì˜ ëª¨ë“  ë¶„ì„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ, **ë²ˆì—­ê°€ì—ê²Œ ì§ì ‘ ì „ë‹¬í•˜ëŠ” ë¶€ë“œëŸ½ê³  ê±´ì„¤ì ì¸ ì–´ì¡°**ë¡œ í˜„ì¬ ì—­ëŸ‰ ìˆ˜ì¤€ì— ëŒ€í•œ ì¢…í•© í‰ê°€ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
      * í‰ê°€ëŠ” ê°ì •ì ì´ê±°ë‚˜ ëª¨í˜¸í•´ì„œëŠ” ì•ˆ ë˜ë©°, ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê°ê´€ì ì´ê³  ê±´ì„¤ì ì¸ í”¼ë“œë°±ì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.
      * ì¹­ì°¬ê³¼ ê°œì„ ì ì„ ê· í˜• ìˆê²Œ ì œì‹œí•˜ì—¬ ë²ˆì—­ê°€ê°€ í”¼ë“œë°±ì„ ê¸ì •ì ìœ¼ë¡œ ìˆ˜ìš©í•˜ê³  ì„±ì¥í•  ìˆ˜ ìˆë„ë¡ ë…ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.
      * ì•ìœ¼ë¡œì˜ ì„±ì¥ì„ ìœ„í•´ ë¬´ì—‡ì„ ì§‘ì¤‘ì ìœ¼ë¡œ ê°œì„ í•´ì•¼ í• ì§€, ì–´ë–¤ ì ì„ ìœ ì˜í•´ì•¼ í• ì§€ì— ëŒ€í•œ êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì–¸ì„ 1~2ê°€ì§€ ì œì‹œí•©ë‹ˆë‹¤.
      * íŠ¹íˆ íŠ¹ì • ë¶€ë¶„ì—ì„œ ê°œì„ ì´ í•„ìš”í•˜ë‹¤ê³  í•  ë•Œ ì‹¤ì œì˜ ì˜ˆì‹œ(2~3ê°œ)ì™€ ì—í”¼ì†Œë“œ í™”ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”¼ë“œë°±ì„ ì œê³µí•´ì„œ ì‘ì—…ìê°€ ì–´ë–¤ ë¶€ë¶„ì— ìˆì–´ì„œ ì‹¤ìˆ˜ë¥¼ í–ˆì—ˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
      * ì£¼ì˜: ì´ ì„¹ì…˜ì€ ë²ˆì—­ê°€ì˜ ì„±ì¥ì„ ë•ëŠ” ì •ì„±ì  í”¼ë“œë°±ì— ì§‘ì¤‘í•´ì•¼ í•˜ë¯€ë¡œ, ì •ëŸ‰ ë¶„ì„ì˜ ì ìˆ˜ë‚˜ ë“±ê¸‰ê³¼ ê°™ì€ ìˆ˜ì¹˜ì  ê²°ê³¼ë¥¼ ì ˆëŒ€ë¡œ ì§ì ‘ ì–¸ê¸‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ì¶œë ¥ í˜•ì‹**:
ë‹¤ìŒ ë§ˆí¬ë‹¤ìš´(Markdown) í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë³´ê³ ì„œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

```markdown
## ë²ˆì—­ê°€ ì¢…í•© í‰ê°€ ë³´ê³ ì„œ

**ë²ˆì—­ê°€ ID**: [ë²ˆì—­ê°€ ID ë˜ëŠ” ì´ë¦„]
**í‰ê°€ ê¸°ê°„**: [ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” ì‘ì—… ê¸°ê°„]

---


### 1. ì •ëŸ‰ ë¶„ì„ (Quantitative Analysis)

* **ì „ì²´ í†µê³„**:
    * ê²€ìˆ˜ ì—í”¼ì†Œë“œ: [ì—í”¼ì†Œë“œ ìˆ˜]ê°œ
    * ì´ í…ìŠ¤íŠ¸ë°•ìŠ¤: [í…ìŠ¤íŠ¸ë°•ìŠ¤ ìˆ˜]ê°œ
    * ê²€ìˆ˜ ë¹„ìœ¨: [ê²€ìˆ˜ ë¹„ìœ¨]%
* **ìˆ˜ì • íƒœê·¸ ë¹ˆë„ ë° ë¹„ìœ¨**:
    * ìœ¤ë¬¸: [ë¹„ìœ¨]%
    * ë¬¸ë²•: [ë¹„ìœ¨]%
    * ì˜¤ì—­: [ë¹„ìœ¨]%
    * ì˜ì„±ì–´/ì˜íƒœì–´: [ë¹„ìœ¨]%
    * ì˜¤íƒˆì: [ë¹„ìœ¨]%
    * ê°€ì´ë“œ ì¤€ìˆ˜: [ë¹„ìœ¨]%
        * [ê°€ì´ë“œ ì¤€ìˆ˜] í‘œê¸°ë²• ì¤€ìˆ˜: [ë¹„ìœ¨]%
        * [ê°€ì´ë“œ ì¤€ìˆ˜] ì„¤ì •ì§‘ ë°˜ì˜: [ë¹„ìœ¨]%
        * [ê°€ì´ë“œ ì¤€ìˆ˜] ì´ì™¸ í•­ëª© ë¯¸ì¤€ìˆ˜: [ë¹„ìœ¨]%

* **ë²ˆì—­ í’ˆì§ˆ í‰ê°€ ì ìˆ˜**:
    * **ì´ì **: [ì´ì ]/24
    * **ë“±ê¸‰**: [ë“±ê¸‰]
* **ì˜ì—­ë³„ ìƒì„¸ ì ìˆ˜**:
    * ì˜¤ì—­: [ì ìˆ˜]/6
    * ë¬¸ë²•: [ì ìˆ˜]/6
    * ìœ¤ë¬¸: [ì ìˆ˜]/6
    * ì˜¤íƒˆì: [ì ìˆ˜]/3
    * ê°€ì´ë“œ ì¤€ìˆ˜: [ì ìˆ˜]/3

---

### 2. ì£¼ìš” ìˆ˜ì • ì‚¬í•­ ë¶„ì„ (Qualitative Analysis)

#### **ì˜í•œ ì  (Strengths)**

* (ì˜ˆ: ì „ë°˜ì ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì²´ êµ¬ì‚¬ ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ë©°, íŠ¹íˆ ìºë¦­í„°ì˜ ê°ì •ì„ ì‚´ë¦¬ëŠ” 'ìœ¤ë¬¸' ì™¸ì—ëŠ” í° ìˆ˜ì •ì´ í•„ìš” ì—†ëŠ” ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.)

#### **ê°œì„ ì  (Areas for Improvement)**

* **[ê°€ì¥ ë¹ˆë²ˆí•œ íƒœê·¸, ì˜ˆ: ë¬¸ë²•]**: [í•´ë‹¹ íƒœê·¸ì™€ ê´€ë ¨ëœ ì‹¤ìˆ˜ íŒ¨í„´ì— ëŒ€í•œ ì„¤ëª…]
    * **ì˜ˆì‹œ 1**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)

* **[ë‘ ë²ˆì§¸ë¡œ ë¹ˆë²ˆí•œ íƒœê·¸, ì˜ˆ: [ê°€ì´ë“œ ì¤€ìˆ˜] ì„¤ì •ì§‘ ë°˜ì˜]**: [í•´ë‹¹ íƒœê·¸ì™€ ê´€ë ¨ëœ ì‹¤ìˆ˜ íŒ¨í„´ì— ëŒ€í•œ ì„¤ëª…]
    * **ì˜ˆì‹œ 1**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)

---

### 3. ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ (Critical Issues)

* (ì¹˜ëª…ì ì¸ 'ì˜¤ì—­'ì´ë‚˜ ê°€ì´ë“œë¼ì¸ ìœ„ë°˜ ì‚¬ë¡€ê°€ ìˆì—ˆë‹¤ë©´ ì—¬ê¸°ì— êµ¬ì²´ì ì¸ ì˜ˆì‹œì™€ í•¨ê»˜ ì„œìˆ í•©ë‹ˆë‹¤. ì—†ë‹¤ë©´ "ì´ë²ˆ í‰ê°€ ê¸°ê°„ ë™ì•ˆ íŠ¹ë³„í•œ ì¹˜ëª…ì  ì˜¤ë¥˜ëŠ” ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."ë¼ê³  ì‘ì„±í•©ë‹ˆë‹¤.)
    * **ì˜¤ì—­ ì‚¬ë¡€**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
        * **ì½”ë©˜íŠ¸**: ì›ë¬¸ì˜ í•µì‹¬ ì˜ë¯¸ë¥¼ ë°˜ëŒ€ë¡œ ë²ˆì—­í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ í° í˜¼ë€ì„ ì¤„ ìˆ˜ ìˆëŠ” ì‹¬ê°í•œ ì˜¤ë¥˜ì…ë‹ˆë‹¤.

---

### 4. ì´í‰ ë° ê¶Œì¥ì‚¬í•­ (Overall Summary & Recommendations)

(ì˜ˆì‹œ)
ë²ˆì—­ê°€ë‹˜ê»˜ì„œëŠ” [ì „ë°˜ì ì¸ ê°•ì ì— ëŒ€í•œ ë¶€ë“œëŸ¬ìš´ ì¹­ì°¬ê³¼ ìš”ì•½]ê³¼ ê°™ì€ ê¸ì •ì ì¸ ì—­ëŸ‰ì„ ê¾¸ì¤€íˆ ë³´ì—¬ì£¼ê³  ê³„ì‹­ë‹ˆë‹¤.

ë‹¤ë§Œ, **[ì—¬ì „íˆ ê°œì„ ì´ í•„ìš”í•œ ì , ì˜ˆ: íŠ¹ì • ë¬¸ë²• ì˜¤ë¥˜] ë¶€ë¶„ì€ ê°œì„ ì„ ìœ„í•œ ì§‘ì¤‘ì ì¸ ë…¸ë ¥ì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤.** ì´ ì ì„ ë³´ì™„í•˜ì‹ ë‹¤ë©´ ì•ìœ¼ë¡œ ë”ìš± ë›°ì–´ë‚œ ê²°ê³¼ë¬¼ì„ ë§Œë“¤ì–´ë‚´ì‹¤ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

**1. [ê°œì„  ì œì–¸ 1, ì˜ˆ: ë¬¸ë§¥ì˜ íë¦„ì„ ê³ ë ¤í•œ ë²ˆì—­]**
* [ì œì–¸ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ì„¤ëª…]
* **ì°¸ê³  ì˜ˆì‹œ**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
* **ì°¸ê³  ì˜ˆì‹œ**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
* **ì°¸ê³  ì˜ˆì‹œ**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)

**2. [ê°œì„  ì œì–¸ 2, ì˜ˆ: íŠ¹ì • ë¬¸ë²• ê·œì¹™ ì¬ì ê²€]**
* [ì œì–¸ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ì„¤ëª…]
* íŠ¹íˆ, ë‹¤ìŒ ë¬¸ë²• ì‚¬í•­ë“¤ì— ì¡°ê¸ˆ ë” ì£¼ì˜ë¥¼ ê¸°ìš¸ì—¬ ì£¼ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.
    * **[ìì£¼ í‹€ë¦¬ëŠ” ë¬¸ë²• ê·œì¹™ 1]**: [ê·œì¹™ì— ëŒ€í•œ ê°„ëµí•œ ì„¤ëª…]
        * **ì˜ˆì‹œ**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
        * **ì˜ˆì‹œ**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
        * **ì˜ˆì‹œ**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)

ì•ìœ¼ë¡œ ìœ„ ì‚¬í•­ë“¤ì„ ì—¼ë‘ì— ë‘ì‹œê³  ì‘ì—…ì— ì„í•´ì£¼ì‹ ë‹¤ë©´ ë²ˆì—­ì˜ ì •í™•ì„±ê³¼ ì™„ì„±ë„ë¥¼ ë”ìš± ë†’ì¼ ìˆ˜ ìˆì„ ê²ƒì´ë¼ í™•ì‹ í•©ë‹ˆë‹¤. ë²ˆì—­ê°€ë‹˜ì˜ ì„±ì¥ì„ í•­ìƒ ì‘ì›í•˜ê² ìŠµë‹ˆë‹¤.
```"""
        except Exception as e:
            print(f"âš ï¸ í”„ë¡¬í”„íŠ¸ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}")
            print("ê¸°ë³¸ í•˜ë“œì½”ë”©ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
            return """**ì—­í• **: ë‹¹ì‹ ì€ ë²ˆì—­íŒ€ì„ ì´ê´„í•˜ëŠ” ì „ë¬¸ ë²ˆì—­ í’ˆì§ˆ ê´€ë¦¬ì(Lead Reviewer)ì…ë‹ˆë‹¤.

**ì‘ì—… ì§€ì‹œ**: ë‹¤ìŒ JSON í˜•ì‹ì˜ ì…ë ¥ ë°ì´í„°ëŠ” íŠ¹ì • ë²ˆì—­ ì‘ì—…ìê°€ ì‘ì—…í•œ ì—¬ëŸ¬ ê²°ê³¼ë¬¼ì— ëŒ€í•œ ê²€ìˆ˜ ê¸°ë¡ì…ë‹ˆë‹¤. ì´ ë°ì´í„°ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬, í•´ë‹¹ ì‘ì—…ìì˜ ì„±ê³¼ë¥¼ í‰ê°€í•˜ê³  ì„±ì¥ì„ ë•ê¸° ìœ„í•œ **ì¢…í•© í‰ê°€ ë³´ê³ ì„œ**ë¥¼ ì‘ì„±í•˜ì„¸ìš”."""
    
    def _get_followup_system_prompt(self) -> str:
        """ê¸°ì¡´ í”¼ë“œë°±ì´ ìˆëŠ” ê²½ìš°ì˜ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ íŒŒì¼ì—ì„œ ì½ì–´ ë°˜í™˜í•©ë‹ˆë‹¤."""
        prompt_file_path = "../data/prompt/overall_feedback_generation_prompt_followup.txt"
        try:
            with open(prompt_file_path, 'r', encoding='utf-8') as f:
                return f.read().strip()
        except FileNotFoundError:
            print(f"âš ï¸ í”„ë¡¬í”„íŠ¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {prompt_file_path}")
            print("ê¸°ë³¸ í•˜ë“œì½”ë”©ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
            return """**ì—­í• **: ë‹¹ì‹ ì€ ë²ˆì—­íŒ€ì„ ì´ê´„í•˜ëŠ” ì „ë¬¸ ë²ˆì—­ í’ˆì§ˆ ê´€ë¦¬ì(Lead Reviewer)ì…ë‹ˆë‹¤.

**ì‘ì—… ì§€ì‹œ**: ë‹¤ìŒ JSON í˜•ì‹ì˜ ì…ë ¥ ë°ì´í„°ëŠ” íŠ¹ì • ë²ˆì—­ ì‘ì—…ìê°€ ì‘ì—…í•œ ì—¬ëŸ¬ ê²°ê³¼ë¬¼ì— ëŒ€í•œ ê²€ìˆ˜ ê¸°ë¡ì…ë‹ˆë‹¤. ì´ ë°ì´í„°ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬, í•´ë‹¹ ì‘ì—…ìì˜ ì„±ê³¼ë¥¼ í‰ê°€í•˜ê³  ì„±ì¥ì„ ë•ê¸° ìœ„í•œ **ì¢…í•© í‰ê°€ ë³´ê³ ì„œ**ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

**ì…ë ¥ ë°ì´í„° í˜•ì‹**:
1.  **í†µí•© í†µê³„ íŒŒì¼**: í”„ë¡œì íŠ¸ ì „ë°˜ì˜ ì •ëŸ‰ì  ë°ì´í„°ë¥¼ ìš”ì•½í•œ íŒŒì¼ì…ë‹ˆë‹¤.
2.  **ë²ˆì—­ ê²€ìˆ˜ ë°ì´í„° (JSON ë°°ì—´)**: ì´ë²ˆ ì¢…í•© í‰ê°€ ì‘ì„±ì„ ìœ„í•œ ë²ˆì—­ ê²€ìˆ˜ ë°ì´í„°ì…ë‹ˆë‹¤. ì´ëŠ” ê°œë³„ ë¬¸ì¥ì— ëŒ€í•œ ìˆ˜ì • ì‚¬í•­ì„ ìƒì„¸íˆ ê¸°ë¡í•œ ë°ì´í„°ì…ë‹ˆë‹¤. ì´ëŠ” translated_text(ë²ˆì—­ê°€ì˜ ë²ˆì—­ë¬¸), edited_text(ê²€ìˆ˜ìê°€ ìˆ˜ì •í•œ ë²ˆì—­ë¬¸), tag(ìˆ˜ì • íƒœê·¸), comment(ê° ìˆ˜ì •ì— ëŒ€í•œ ê²€ìˆ˜ì ì½”ë©˜íŠ¸), episode(ê° ë²ˆì—­ë¬¸ê³¼ ê²€ìˆ˜ë¬¸ì´ ì–´ë–¤ ì—í”¼ì†Œë“œì— í•´ë‹¹í•˜ëŠ”ì§€)ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.
3.  **ì´ì „ ì‘ì—…ì— ëŒ€í•œ ì¢…í•© ë³´ê³ ì„œ**: ì´ì „ì— ì‘ì—…ì— ëŒ€í•œ ì¢…í•© ë³´ê³ ì„œì…ë‹ˆë‹¤. ì´ì „ í”¼ë“œë°± ëŒ€ë¹„ ì„±ì¥ ë¶„ì„ ì‹œ ë°˜ë“œì‹œ í˜„ì¬ í‰ê°€ì™€ ë¹„êµ ë¶„ì„í•´ì•¼ í•©ë‹ˆë‹¤.**


**ë¶„ì„ ë° í‰ê°€ ìš”êµ¬ì‚¬í•­**:

1.  **ì •ëŸ‰ì  ë°ì´í„° ìš”ì•½**:

      * í†µí•© í†µê³„ íŒŒì¼ì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ **ì „ì²´ í†µê³„, íƒœê·¸ë³„ ë¹ˆë„ ë° ë¹„ìœ¨, ë²ˆì—­ í’ˆì§ˆ ì´ì  ë° ë“±ê¸‰, ì˜ì—­ë³„ ìƒì„¸ ì ìˆ˜**ë¥¼ ë³´ê³ ì„œì˜ 'ì •ëŸ‰ ë¶„ì„' ì„¹ì…˜ì— ì •í™•íˆ ê¸°ì¬í•©ë‹ˆë‹¤.

2.  **ì •ì„±ì  íŒ¨í„´ ë¶„ì„**:

      * **ì˜í•œ ì  (Strengths)**: ë²ˆì—­ê°€ì˜ í˜„ì¬ ê°•ì ì„ íŒŒì•…í•˜ê³  ì¹­ì°¬í•©ë‹ˆë‹¤. ìˆ˜ì •ì´ ê±°ì˜ ì—†ì—ˆê±°ë‚˜, 'ìœ¤ë¬¸' íƒœê·¸ë§Œ ì ìš©ëœ ì‚¬ë¡€ ë“± ë²ˆì—­ê°€ì˜ ê°•ì ì´ ë“œëŸ¬ë‚˜ëŠ” ë¶€ë¶„ì„ íŒŒì•…í•˜ê³  ì¹­ì°¬í•©ë‹ˆë‹¤.
      * **ê°œì„ ì  (Areas for Improvement)**: í˜„ì¬ ì‘ì—…ë¬¼ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” ì£¼ìš” ì‹¤ìˆ˜ íŒ¨í„´ì„ ë¶„ì„í•©ë‹ˆë‹¤. ê°€ì¥ ë¹ˆë²ˆí•˜ê²Œ ë‚˜íƒ€ë‚œ íƒœê·¸ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ, ë²ˆì—­ê°€ì˜ ì£¼ìš” ì‹¤ìˆ˜ íŒ¨í„´ì„ ë¶„ì„í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ë¬¸ë²• ì˜¤ë¥˜ê°€ ë°˜ë³µë˜ëŠ”ì§€, ìš©ì–´ì§‘ ì¤€ìˆ˜ìœ¨ì´ ë‚®ì€ì§€ ë“±ì„ íŒŒì•…í•©ë‹ˆë‹¤.
      * ë¶„ì„ ì‹œ, ë°˜ë“œì‹œ ì…ë ¥ ë°ì´í„°ì—ì„œ **êµ¬ì²´ì ì¸ ì˜ˆì‹œ(`translated_text` â†’ `edited_text`)ì™€ ì—í”¼ì†Œë“œ í™”ìˆ˜ë¥¼ 2-3ê°œ ì´ìƒ ì¸ìš©**í•˜ì—¬ ê·¼ê±°ë¥¼ ëª…í™•íˆ ì œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

3.  **ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ì‹ë³„ (Critical Issues)**:

      * 'ì˜¤ì—­'ê³¼ ê°™ì´ ì›ë¬¸ì˜ ì˜ë¯¸ë¥¼ ì‹¬ê°í•˜ê²Œ í›¼ì†í•œ ì‚¬ë¡€ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
      * '[ê°€ì´ë“œ ì¤€ìˆ˜] ì„¤ì •ì§‘ ë°˜ì˜' ë“± í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ê°€ì´ë“œë¼ì¸ì„ ë°˜ë³µì ìœ¼ë¡œ ìœ„ë°˜í•œ ì‚¬ë¡€ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
      * ì´ëŸ¬í•œ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ëŠ” ë³„ë„ë¡œ ë¶„ë¥˜í•˜ì—¬ ëª…í™•í•˜ê²Œ ì§€ì í•´ì•¼ í•©ë‹ˆë‹¤.

4.  **ì´ì „ í”¼ë“œë°± ëŒ€ë¹„ ì„±ì¥ ë¶„ì„ (`previous_feedback` í™œìš©)**:

      * ì´ì „ ì‘ì—…ì— ëŒ€í•œ ì¢…í•© ë³´ê³ ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ì´ì „ì— ì§€ì ë˜ì—ˆë˜ í•­ëª©ë“¤ì´ í˜„ì¬ ì‘ì—…ì—ì„œ ê°œì„ ë˜ì—ˆëŠ”ì§€ í˜¹ì€ ì—¬ì „íˆ ë¬¸ì œê°€ ë˜ëŠ”ì§€ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
      * **ê°œì„ ëœ ì **ê³¼ **ì—¬ì „íˆ ê°œì„ ì´ í•„ìš”í•œ ì **ì„ ê°ê° êµ¬ì²´ì ì¸ í˜„ì¬ ì˜ˆì‹œì™€ í•¨ê»˜ ì œì‹œí•˜ì—¬ ë³€í™”ë¥¼ ëª…í™•í•˜ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤.
      * ìˆ˜ì¹˜ì ìœ¼ë¡œ ì´ì „ ì‘ì—… ëŒ€ë¹„ ì˜¤ë¥˜ ìœ í˜•ì—ì„œì˜ ë¹„ìœ¨ì´ ì–´ë–¤ ì‹ìœ¼ë¡œ ë³€í™”í•˜ì˜€ëŠ”ì§€ë„ í•¨ê»˜ ë¶„ì„í•©ë‹ˆë‹¤.

5.  **ì¢…í•© ì˜ê²¬ ë° ì œì–¸ (Overall Summary & Recommendations)**:

      * ìœ„ì˜ ëª¨ë“  ë¶„ì„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ, **ë²ˆì—­ê°€ì—ê²Œ ì§ì ‘ ì „ë‹¬í•˜ëŠ” ë¶€ë“œëŸ½ê³  ê±´ì„¤ì ì¸ ì–´ì¡°**ë¡œ í˜„ì¬ ì—­ëŸ‰ ìˆ˜ì¤€ì— ëŒ€í•œ ì¢…í•© í‰ê°€ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
      * í‰ê°€ëŠ” ê°ì •ì ì´ê±°ë‚˜ ëª¨í˜¸í•´ì„œëŠ” ì•ˆ ë˜ë©°, ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê°ê´€ì ì´ê³  ê±´ì„¤ì ì¸ í”¼ë“œë°±ì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.
      * ì¹­ì°¬ê³¼ ê°œì„ ì ì„ ê· í˜• ìˆê²Œ ì œì‹œí•˜ì—¬ ë²ˆì—­ê°€ê°€ í”¼ë“œë°±ì„ ê¸ì •ì ìœ¼ë¡œ ìˆ˜ìš©í•˜ê³  ì„±ì¥í•  ìˆ˜ ìˆë„ë¡ ë…ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.
      * ì•ìœ¼ë¡œì˜ ì„±ì¥ì„ ìœ„í•´ ë¬´ì—‡ì„ ì§‘ì¤‘ì ìœ¼ë¡œ ê°œì„ í•´ì•¼ í• ì§€, ì–´ë–¤ ì ì„ ìœ ì˜í•´ì•¼ í• ì§€ì— ëŒ€í•œ êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì–¸ì„ 1~2ê°€ì§€ ì œì‹œí•©ë‹ˆë‹¤.
      * íŠ¹íˆ íŠ¹ì • ë¶€ë¶„ì—ì„œ ê°œì„ ì´ í•„ìš”í•˜ë‹¤ê³  í•  ë•Œ ì‹¤ì œì˜ ì˜ˆì‹œ(2~3ê°œ)ì™€ ì—í”¼ì†Œë“œ í™”ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”¼ë“œë°±ì„ ì œê³µí•´ì„œ ì‘ì—…ìê°€ ì–´ë–¤ ë¶€ë¶„ì— ìˆì–´ì„œ ì‹¤ìˆ˜ë¥¼ í–ˆì—ˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
      **ì´ì „ ëŒ€ë¹„ ì„±ì¥í•˜ê±°ë‚˜ ê°œì„ ëœ ë¶€ë¶„ì„ ëª…í™•íˆ ì–¸ê¸‰í•˜ì—¬ ê²©ë ¤**í•˜ê³ , ì—¬ì „íˆ ê°œì„ ì´ í•„ìš”í•œ ì ì€ ì¥ê¸°ì ì¸ ê´€ì ì—ì„œ ì¡°ì–¸í•©ë‹ˆë‹¤.
      * ì£¼ì˜: ì´ ì„¹ì…˜ì€ ë²ˆì—­ê°€ì˜ ì„±ì¥ì„ ë•ëŠ” ì •ì„±ì  í”¼ë“œë°±ì— ì§‘ì¤‘í•´ì•¼ í•˜ë¯€ë¡œ, ì •ëŸ‰ ë¶„ì„ì˜ ì ìˆ˜ë‚˜ ë“±ê¸‰ê³¼ ê°™ì€ ìˆ˜ì¹˜ì  ê²°ê³¼ë¥¼ ì ˆëŒ€ë¡œ ì§ì ‘ ì–¸ê¸‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ì¶œë ¥ í˜•ì‹**:
ë‹¤ìŒ ë§ˆí¬ë‹¤ìš´(Markdown) í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë³´ê³ ì„œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

```markdown
## ë²ˆì—­ê°€ ì¢…í•© í‰ê°€ ë³´ê³ ì„œ

**ë²ˆì—­ê°€ ID**: [ë²ˆì—­ê°€ ID ë˜ëŠ” ì´ë¦„]
**í‰ê°€ ê¸°ê°„**: [ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” ì‘ì—… ê¸°ê°„]

---


### 1. ì •ëŸ‰ ë¶„ì„ (Quantitative Analysis)

* **ì „ì²´ í†µê³„**:
    * ê²€ìˆ˜ ì—í”¼ì†Œë“œ: [ì—í”¼ì†Œë“œ ìˆ˜]ê°œ
    * ì´ í…ìŠ¤íŠ¸ë°•ìŠ¤: [í…ìŠ¤íŠ¸ë°•ìŠ¤ ìˆ˜]ê°œ
    * ê²€ìˆ˜ ë¹„ìœ¨: [ê²€ìˆ˜ ë¹„ìœ¨]%
* **ìˆ˜ì • íƒœê·¸ ë¹ˆë„ ë° ë¹„ìœ¨**:
    * ìœ¤ë¬¸: [ë¹„ìœ¨]%
    * ë¬¸ë²•: [ë¹„ìœ¨]%
    * ì˜¤ì—­: [ë¹„ìœ¨]%
    * ì˜ì„±ì–´/ì˜íƒœì–´: [ë¹„ìœ¨]%
    * ì˜¤íƒˆì: [ë¹„ìœ¨]%
    * ê°€ì´ë“œ ì¤€ìˆ˜: [ë¹„ìœ¨]%
        * [ê°€ì´ë“œ ì¤€ìˆ˜] í‘œê¸°ë²• ì¤€ìˆ˜: [ë¹„ìœ¨]%
        * [ê°€ì´ë“œ ì¤€ìˆ˜] ì„¤ì •ì§‘ ë°˜ì˜: [ë¹„ìœ¨]%
        * [ê°€ì´ë“œ ì¤€ìˆ˜] ì´ì™¸ í•­ëª© ë¯¸ì¤€ìˆ˜: [ë¹„ìœ¨]%

* **ë²ˆì—­ í’ˆì§ˆ í‰ê°€ ì ìˆ˜**:
    * **ì´ì **: [ì´ì ]/24
    * **ë“±ê¸‰**: [ë“±ê¸‰]
* **ì˜ì—­ë³„ ìƒì„¸ ì ìˆ˜**:
    * ì˜¤ì—­: [ì ìˆ˜]/6
    * ë¬¸ë²•: [ì ìˆ˜]/6
    * ìœ¤ë¬¸: [ì ìˆ˜]/6
    * ì˜¤íƒˆì: [ì ìˆ˜]/3
    * ê°€ì´ë“œ ì¤€ìˆ˜: [ì ìˆ˜]/3

---

### 2. ì£¼ìš” ìˆ˜ì • ì‚¬í•­ ë¶„ì„ (Qualitative Analysis)

#### **ì˜í•œ ì  (Strengths)**

* (ì˜ˆ: ì „ë°˜ì ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì²´ êµ¬ì‚¬ ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ë©°, íŠ¹íˆ ìºë¦­í„°ì˜ ê°ì •ì„ ì‚´ë¦¬ëŠ” 'ìœ¤ë¬¸' ì™¸ì—ëŠ” í° ìˆ˜ì •ì´ í•„ìš” ì—†ëŠ” ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.)

#### **ê°œì„ ì  (Areas for Improvement)**

* **[ê°€ì¥ ë¹ˆë²ˆí•œ íƒœê·¸, ì˜ˆ: ë¬¸ë²•]**: [í•´ë‹¹ íƒœê·¸ì™€ ê´€ë ¨ëœ ì‹¤ìˆ˜ íŒ¨í„´ì— ëŒ€í•œ ì„¤ëª…]
    * **ì˜ˆì‹œ 1**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)

* **[ë‘ ë²ˆì§¸ë¡œ ë¹ˆë²ˆí•œ íƒœê·¸, ì˜ˆ: [ê°€ì´ë“œ ì¤€ìˆ˜] ì„¤ì •ì§‘ ë°˜ì˜]**: [í•´ë‹¹ íƒœê·¸ì™€ ê´€ë ¨ëœ ì‹¤ìˆ˜ íŒ¨í„´ì— ëŒ€í•œ ì„¤ëª…]
    * **ì˜ˆì‹œ 1**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
    * **ì˜ˆì‹œ 2**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)

---

### 3. ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ (Critical Issues)

* (ì¹˜ëª…ì ì¸ 'ì˜¤ì—­'ì´ë‚˜ ê°€ì´ë“œë¼ì¸ ìœ„ë°˜ ì‚¬ë¡€ê°€ ìˆì—ˆë‹¤ë©´ ì—¬ê¸°ì— êµ¬ì²´ì ì¸ ì˜ˆì‹œì™€ í•¨ê»˜ ì„œìˆ í•©ë‹ˆë‹¤. ì—†ë‹¤ë©´ "ì´ë²ˆ í‰ê°€ ê¸°ê°„ ë™ì•ˆ íŠ¹ë³„í•œ ì¹˜ëª…ì  ì˜¤ë¥˜ëŠ” ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."ë¼ê³  ì‘ì„±í•©ë‹ˆë‹¤.)
    * **ì˜¤ì—­ ì‚¬ë¡€**: `translated_text` â†’ `edited_text` (ì—í”¼ì†Œë“œ ní™”)
        * **ì½”ë©˜íŠ¸**: ì›ë¬¸ì˜ í•µì‹¬ ì˜ë¯¸ë¥¼ ë°˜ëŒ€ë¡œ ë²ˆì—­í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ í° í˜¼ë€ì„ ì¤„ ìˆ˜ ìˆëŠ” ì‹¬ê°í•œ ì˜¤ë¥˜ì…ë‹ˆë‹¤.

---

### 4. ì´ì „ í”¼ë“œë°± ëŒ€ë¹„ ì„±ì¥ ë¶„ì„ (Analysis of Growth Since Last Review)

ì´ì „ ë³´ê³ ì„œì—ì„œ ì œì‹œëœ í”¼ë“œë°±ì„ ë°”íƒ•ìœ¼ë¡œ, ë²ˆì—­ê°€ì˜ ì„±ì¥ ë° ê°œì„ ì ì„ **ì •ëŸ‰ì  ë°ì´í„°ì™€ ì •ì„±ì  ì˜ˆì‹œë¥¼ í†µí•©í•˜ì—¬** ì‹¬ì¸µì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.

#### **ê°œì„ ëœ ì  (Improvements)**
* **ì–´ë–¤ ì ì´ ê°œì„ ë˜ì—ˆëŠ”ì§€ ë¶„ì„**: ì´ì „ ë³´ê³ ì„œì—ì„œ ì§€ì ëœ ë¬¸ì œì ì´ ì´ë²ˆ ì‘ì—…ì—ì„œ ì–´ë–»ê²Œ ê°œì„ ë˜ì—ˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.
* **ìˆ˜ì¹˜ì  ë³€í™” ì œì‹œ**: ê´€ë ¨ ì˜¤ë¥˜ íƒœê·¸ì˜ ë¹„ìœ¨ ë³€í™”ë¥¼ ì–¸ê¸‰í•˜ì—¬ ê°œì„ ì ì„ ë°ì´í„°ë¡œ ì¦ëª…í•©ë‹ˆë‹¤. (ì˜ˆ: "ì§€ë‚œë²ˆ 15%ì— ë‹¬í–ˆë˜ '[ê°€ì´ë“œ ì¤€ìˆ˜] ì„¤ì •ì§‘ ë°˜ì˜' ì˜¤ë¥˜ê°€ ì´ë²ˆì—ëŠ” 3%ë¡œ í¬ê²Œ ê°ì†Œí–ˆìŠµë‹ˆë‹¤.")
* **ì‘ì„± ê°€ì´ë“œ**: ë§Œì•½ ì´ì „ í”¼ë“œë°± í•­ëª©ì´ ëšœë ·í•˜ê²Œ ê°œì„ ë˜ì§€ ì•Šì•˜ë‹¤ë©´, ê¸°ì¡´ì— ì˜í•˜ê³  ìˆë˜ ì (ì˜ˆ: ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì¥ êµ¬ì‚¬ë ¥)ì„ ê¾¸ì¤€íˆ ìœ ì§€í•˜ê³  ìˆëŠ” ë¶€ë¶„ì„ ì–¸ê¸‰í•˜ëŠ” ê²ƒìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### **ì—¬ì „íˆ ê°œì„ ì´ í•„ìš”í•œ ì  (Areas Still Needing Improvement)**
* **ì–´ë–¤ ì ì´ ì—¬ì „í•œì§€ ë¶„ì„**: ì§€ë‚œë²ˆì—ë„ ì§€ì ë˜ì—ˆìœ¼ë‚˜ ì´ë²ˆ ì‘ì—…ì—ì„œë„ ìœ ì‚¬í•˜ê²Œ ë°˜ë³µë˜ëŠ” ì‹¤ìˆ˜ íŒ¨í„´ì´ë‚˜ ìŠµê´€ì„ ë¶„ì„í•©ë‹ˆë‹¤.
* **ìˆ˜ì¹˜ì  ê·¼ê±° ì œì‹œ**: í•´ë‹¹ ì‹¤ìˆ˜ê°€ ì†í•œ íƒœê·¸ì˜ ë¹„ìœ¨ì´ ì—¬ì „íˆ ë†’ê±°ë‚˜ ì´ì „ê³¼ ë¹„ìŠ·í•˜ë‹¤ëŠ” ì ì„ ìˆ˜ì¹˜ë¡œ ì–¸ê¸‰í•©ë‹ˆë‹¤. (ì˜ˆ: "ì§€ë‚œë²ˆê³¼ ë§ˆì°¬ê°€ì§€ë¡œ 'ë¬¸ë²•' ì˜¤ë¥˜ê°€ ì „ì²´ ìˆ˜ì •ì˜ 25%ë¥¼ ì°¨ì§€í•˜ë©°, íŠ¹íˆ ì¡°ì‚¬ì˜ ì–´ìƒ‰í•œ ì‚¬ìš©ì´ ìì£¼ ë°œê²¬ë©ë‹ˆë‹¤.")
* **êµ¬ì²´ì ì¸ ì‹¤ìˆ˜ ì˜ˆì‹œ ì¸ìš©**: ë¬¸ì œì ì´ ëª…í™•íˆ ë“œëŸ¬ë‚˜ëŠ” **ì‹¤ìˆ˜ ì˜ˆì‹œ(`translated_text` â†’ `edited_text`)ë¥¼ ì—í”¼ì†Œë“œ í™”ìˆ˜ì™€ í•¨ê»˜ 2~3ê°œ ì´ìƒ ì œì‹œ**í•˜ì—¬, ë²ˆì—­ê°€ê°€ ìì‹ ì˜ íŒ¨í„´ì„ ê°ê´€ì ìœ¼ë¡œ ì¸ì§€í•˜ê³  ê°œì„  ë°©í–¥ì„ ì¡ì„ ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.

---

### 5. ì¢…í•© ì˜ê²¬ ë° ì œì–¸ (Overall Summary & Recommendations)

#### **ì¢…í•© ì˜ê²¬**
* **ì‹œì‘**: ì´ë²ˆ í‰ê°€ ê¸°ê°„ ë™ì•ˆ ë³´ì—¬ì¤€ ê¸ì •ì ì¸ ëª¨ìŠµê³¼ ì„±ì¥ì„ ë¨¼ì € ì–¸ê¸‰í•˜ë©° ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. (ì˜ˆ: "ì´ë²ˆ ì‘ì—…ì—ì„œë„ ë²ˆì—­ê°€ë‹˜ íŠ¹ìœ ì˜ ìœ ë ¤í•œ ë¬¸ì²´ ë•ë¶„ì— ì „ë°˜ì ìœ¼ë¡œ ê°€ë…ì„±ì´ ë§¤ìš° ì¢‹ì•˜ìŠµë‹ˆë‹¤. íŠ¹íˆ ì§€ë‚œë²ˆ í”¼ë“œë°± ë“œë ¸ë˜ [ê°œì„ ëœ ì , ì˜ˆ: ì„¤ì •ì§‘ ì¤€ìˆ˜] ë¶€ë¶„ì„ ì‹ ê²½ ì¨ì£¼ì‹  ë•ë¶„ì— ìºë¦­í„°ì˜ í†¤ì•¤ë§¤ë„ˆê°€ í•œì¸µ ì•ˆì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
* **ì „í™˜**: ì¹­ì°¬ì„ ë°”íƒ•ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤. 'í•˜ì§€ë§Œ'ì´ë‚˜ 'ë‹¤ë§Œ' ê°™ì€ ì§ì ‘ì ì¸ ë¶€ì • ì ‘ì†ì‚¬ë³´ë‹¤ëŠ”, ì„±ì¥ì„ ìœ„í•œ ì œì•ˆì˜ í˜•íƒœë¡œ ë¶€ë“œëŸ½ê²Œ ì—°ê²°í•©ë‹ˆë‹¤. (ì˜ˆ: "ì´ëŸ¬í•œ ê°•ì ì„ ë°”íƒ•ìœ¼ë¡œ, ë‹¤ìŒ ë‹¨ê³„ë¡œ ë”ìš± ì„±ì¥í•˜ê¸° ìœ„í•´ [ê°€ì¥ ì¤‘ìš”í•œ ê°œì„ ì  1ê°€ì§€, ì˜ˆ: ì¡°ì‚¬ì˜ ìì—°ìŠ¤ëŸ¬ìš´ í™œìš©]ì— ì¡°ê¸ˆ ë” ì§‘ì¤‘í•´ ë³´ì‹œëŠ” ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤.")

#### **ì„±ì¥ì„ ìœ„í•œ ì œì–¸ (Actionable Recommendations)**
ê°€ì¥ ì¤‘ìš”í•˜ê³  ì‹œê¸‰í•œ ê°œì„ ì  ìˆœì„œëŒ€ë¡œ, ì•„ë˜ í˜•ì‹ì— ë§ì¶° êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ì•ˆì„ ì œì•ˆí•©ë‹ˆë‹¤. 'ì¹˜ëª…ì ì¸ ì˜¤ë¥˜'ê°€ ìˆì—ˆë‹¤ë©´ í•´ë‹¹ ë‚´ìš©ì„ ê°€ì¥ ì²« ë²ˆì§¸ ì œì–¸ìœ¼ë¡œ ë‹¤ë£¹ë‹ˆë‹¤.

**1. [ì œì–¸ 1ì˜ ì œëª©]**
* **í˜„ìƒ ì§„ë‹¨**: í˜„ì¬ ë‚˜íƒ€ë‚˜ëŠ” íŒ¨í„´ì„ ê°ê´€ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.
* **ê°œì„  ë°©ì•ˆ**: êµ¬ì²´ì ì´ê³  ì‹¤ì²œ ê°€ëŠ¥í•œ ë°©ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤.
* **ì°¸ê³  ì˜ˆì‹œ (í•´ë‹¹ íŒ¨í„´ì´ ë“œëŸ¬ë‚œ ì‚¬ë¡€ 2~3ê°œ ì¸ìš©)**
    * `translated_text` â†’ `edited_text` (ní™”)
    * `translated_text` â†’ `edited_text` (ní™”)
    * `translated_text` â†’ `edited_text` (ní™”)

**2. [ì œì–¸ 2ì˜ ì œëª©]**
* **í˜„ìƒ ì§„ë‹¨**: (ìœ„ì™€ ë™ì¼)
* **ê°œì„  ë°©ì•ˆ**: (ìœ„ì™€ ë™ì¼)
* **ì°¸ê³  ì˜ˆì‹œ (í•´ë‹¹ íŒ¨í„´ì´ ë“œëŸ¬ë‚œ ì‚¬ë¡€ 2~3ê°œ ì¸ìš©)**
    * `translated_text` â†’ `edited_text` (ní™”)
    * `translated_text` â†’ `edited_text` (ní™”)
    * `translated_text` â†’ `edited_text` (ní™”)

**ë§ˆë¬´ë¦¬**: ê¸ì •ì ì¸ ê²©ë ¤ì™€ ê¸°ëŒ€ë¥¼ ë‹´ì€ ë©”ì‹œì§€ë¡œ ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤. (ì˜ˆ: "ìœ„ì— ì œì•ˆ ë“œë¦° ë¶€ë¶„ë“¤ì„ ì—¼ë‘ì— ë‘ì‹œë©´, ë²ˆì—­ê°€ë‹˜ì˜ ê°•ì ì¸ ë›°ì–´ë‚œ ë¬¸ì¥ë ¥ì´ ë”ìš± ë¹›ì„ ë°œí•  ê²ƒì´ë¼ í™•ì‹ í•©ë‹ˆë‹¤. ë‹¤ìŒ ì‘ì—…ì—ì„œì˜ ë©‹ì§„ ê²°ê³¼ë¬¼ì„ ê¸°ëŒ€í•˜ë©°, ë²ˆì—­ê°€ë‹˜ì˜ ì„±ì¥ì„ í•­ìƒ ì‘ì›í•˜ê² ìŠµë‹ˆë‹¤.")
```"""
        except Exception as e:
            print(f"âš ï¸ í”„ë¡¬í”„íŠ¸ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}")
            print("ê¸°ë³¸ í•˜ë“œì½”ë”©ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
            return """**ì—­í• **: ë‹¹ì‹ ì€ ë²ˆì—­íŒ€ì„ ì´ê´„í•˜ëŠ” ì „ë¬¸ ë²ˆì—­ í’ˆì§ˆ ê´€ë¦¬ì(Lead Reviewer)ì…ë‹ˆë‹¤.

**ì‘ì—… ì§€ì‹œ**: ë‹¤ìŒ JSON í˜•ì‹ì˜ ì…ë ¥ ë°ì´í„°ëŠ” íŠ¹ì • ë²ˆì—­ ì‘ì—…ìê°€ ì‘ì—…í•œ ì—¬ëŸ¬ ê²°ê³¼ë¬¼ì— ëŒ€í•œ ê²€ìˆ˜ ê¸°ë¡ì…ë‹ˆë‹¤. ì´ ë°ì´í„°ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬, í•´ë‹¹ ì‘ì—…ìì˜ ì„±ê³¼ë¥¼ í‰ê°€í•˜ê³  ì„±ì¥ì„ ë•ê¸° ìœ„í•œ **ì¢…í•© í‰ê°€ ë³´ê³ ì„œ**ë¥¼ ì‘ì„±í•˜ì„¸ìš”."""
    
    def _get_episode_directories(self) -> List[str]:
        """ì—í”¼ì†Œë“œ ë””ë ‰í† ë¦¬ ëª©ë¡ì„ ì •ë ¬í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤."""
        directories = []
        for item in os.listdir(self.base_path):
            item_path = os.path.join(self.base_path, item)
            if os.path.isdir(item_path) and item.isdigit():
                directories.append(item)
        
        # ìˆ«ì ìˆœìœ¼ë¡œ ì •ë ¬
        return sorted(directories, key=int)
    
    def _load_previous_feedback(self) -> str:
        """ê¸°ì¡´ í”¼ë“œë°± íŒŒì¼ì„ ì½ì–´ì„œ ë°˜í™˜í•©ë‹ˆë‹¤."""
        if not self.has_previous_feedback or not self.previous_feedback_path:
            return ""
        
        try:
            with open(self.previous_feedback_path, 'r', encoding='utf-8') as f:
                return f.read().strip()
        except FileNotFoundError:
            print(f"ê¸°ì¡´ í”¼ë“œë°± íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {self.previous_feedback_path}")
            return ""
        except Exception as e:
            print(f"ê¸°ì¡´ í”¼ë“œë°± íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {self.previous_feedback_path}, {str(e)}")
            return ""
    
    def _load_unified_statistics(self) -> str:
        """unified_statistics_summary.txt íŒŒì¼ì„ ì½ì–´ì„œ ë°˜í™˜í•©ë‹ˆë‹¤."""
        unified_stats_path = os.path.join(self.base_path, 'unified_statistics_summary.txt')
        
        try:
            with open(unified_stats_path, 'r', encoding='utf-8') as f:
                return f.read().strip()
        except FileNotFoundError:
            print(f"í†µí•© í†µê³„ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {unified_stats_path}")
            return ""
        except Exception as e:
            print(f"í†µí•© í†µê³„ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {unified_stats_path}, {str(e)}")
            return ""
    
    def _load_csv_data(self, csv_path: str) -> List[Dict[str, Any]]:
        """CSV íŒŒì¼ì„ ì½ì–´ì„œ ë”•ì…”ë„ˆë¦¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤."""
        try:
            data = []
            with open(csv_path, 'r', encoding='utf-8') as f:
                reader = csv.DictReader(f)
                for row in reader:
                    # ëª¨ë“  í•„ë“œ ì¶”ì¶œ (translated_text, edited_text, tag, comment)
                    tag = row.get('tag', '').strip()
                    comment = row.get('comment', '').strip()
                    translated_text = row.get('target', '').strip()
                    edited_text = row.get('val', '').strip()
                    
                    # ë¹ˆ íƒœê·¸ëŠ” ì œì™¸
                    if tag:
                        data.append({
                            'translated_text': translated_text,
                            'edited_text': edited_text,
                            'tag': tag,
                            'comment': comment
                        })
            return data
        except FileNotFoundError:
            print(f"íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {csv_path}")
            return []
        except Exception as e:
            print(f"CSV íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {csv_path}, {str(e)}")
            return []
    
    
    def collect_episode_data(self) -> Dict[str, Any]:
        """ëª¨ë“  ì—í”¼ì†Œë“œì˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ JSON í˜•íƒœë¡œ ë°˜í™˜í•©ë‹ˆë‹¤."""
        episode_dirs = self._get_episode_directories()
        collected_data = {
            'metadata': {
                'collection_time': datetime.now().isoformat(),
                'base_path': self.base_path,
                'total_episodes': len(episode_dirs)
            },
            'episodes': {}
        }
        
        all_review_data = []  # ì „ì²´ ë¦¬ë·° ë°ì´í„°ë¥¼ í•˜ë‚˜ë¡œ í†µí•©
        
        for episode in episode_dirs:
            episode_path = os.path.join(self.base_path, episode)
            
            # CSV íŒŒì¼ ê²½ë¡œ
            csv_path = os.path.join(episode_path, 'translation_review_llm.csv')
            
            # ë°ì´í„° ë¡œë“œ (metrics ì œì™¸)
            csv_data = self._load_csv_data(csv_path)
            
            # ì—í”¼ì†Œë“œë³„ ë°ì´í„° ì €ì¥
            collected_data['episodes'][f'episode_{episode}'] = {
                'review_data': csv_data,
                'review_count': len(csv_data)
            }
            
            # ì „ì²´ ë°ì´í„°ì— ì¶”ê°€ (ì—í”¼ì†Œë“œ ì •ë³´ í¬í•¨)
            for item in csv_data:
                item_with_episode = item.copy()
                item_with_episode['episode'] = f'episode_{episode}'
                all_review_data.append(item_with_episode)
            
            print(f"ì—í”¼ì†Œë“œ {episode} ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ: {len(csv_data)}ê°œ í•­ëª©")
        
        collected_data['all_review_data'] = all_review_data
        collected_data['total_review_count'] = len(all_review_data)
        
        return collected_data
    
    def _create_user_prompt(self, collected_data: Dict[str, Any]) -> str:
        """ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤."""
        user_prompt = "ë‹¤ìŒì€ ë²ˆì—­ê°€ì˜ ì‘ì—… ê²°ê³¼ì— ëŒ€í•œ ì¢…í•© ë°ì´í„°ì…ë‹ˆë‹¤.\n\n"
        
        # ê¸°ì¡´ í”¼ë“œë°±ì´ ìˆëŠ” ê²½ìš° í¬í•¨
        if self.has_previous_feedback:
            previous_feedback = self._load_previous_feedback()
            if previous_feedback:
                user_prompt += "**ì´ì „ í”¼ë“œë°±**\n"
                user_prompt += previous_feedback + "\n\n"
                user_prompt += "---\n\n"
        
        # í†µí•© í†µê³„ ì •ë³´
        unified_stats = self._load_unified_statistics()
        if unified_stats:
            user_prompt += "**í†µí•© ë²ˆì—­ í’ˆì§ˆ ë¶„ì„ í†µê³„**\n"
            user_prompt += unified_stats + "\n\n"
        else:
            # í†µí•© í†µê³„ íŒŒì¼ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ í†µê³„ ì‚¬ìš©
            user_prompt += f"**ì „ì²´ í†µê³„**\n"
            user_prompt += f"- ì´ ì—í”¼ì†Œë“œ ìˆ˜: {collected_data['metadata']['total_episodes']}ê°œ\n"
            user_prompt += f"- ì´ ê²€ìˆ˜ í•­ëª© ìˆ˜: {collected_data['total_review_count']}ê°œ\n\n"
        
        user_prompt += "**ë²ˆì—­ ê²€ìˆ˜ ë°ì´í„° (JSON í˜•ì‹)**\n"
        user_prompt += json.dumps(collected_data['all_review_data'], ensure_ascii=False, indent=2)
        
        return user_prompt
    
    def generate_report(self, collected_data: Dict[str, Any]) -> str:
        """Gemini-2.5-proë¥¼ ì‚¬ìš©í•˜ì—¬ ì¢…í•© ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤."""
        user_prompt = self._create_user_prompt(collected_data)
        
        try:
            print("Gemini-2.5-proë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...")
            
            # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì™€ ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ë¥¼ ê²°í•©
            full_prompt = f"{self.system_prompt}\n\n{user_prompt}"
            
            response = self.client.models.generate_content(
                model="gemini-2.5-pro",
                config=types.GenerateContentConfig(
                    system_instruction=self.system_prompt,
                    temperature=0
                ),
                contents=user_prompt
            )
            
            return response.text
            
        except Exception as e:
            error_msg = f"ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}"
            print(error_msg)
            return error_msg
    
    def save_report(self, report_content: str, output_path: str = None) -> str:
        """ë¦¬í¬íŠ¸ë¥¼ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤."""
        if output_path is None:
            output_path = os.path.join(self.base_path, f"comprehensive_report.txt")
        
        try:
            with open(output_path, 'w', encoding='utf-8') as f:
                f.write(report_content)
            print(f"ë¦¬í¬íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: {output_path}")
            return output_path
        except Exception as e:
            error_msg = f"ë¦¬í¬íŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}"
            print(error_msg)
            return error_msg
    
    
    def generate_comprehensive_report(self) -> str:
        """ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ì¢…í•© ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤."""
        print("=== ì¢…í•© ë²ˆì—­ ë¦¬í¬íŠ¸ ìƒì„± ì‹œì‘ ===")
        
        # 1. ë°ì´í„° ìˆ˜ì§‘
        print("\n1. ì—í”¼ì†Œë“œë³„ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...")
        collected_data = self.collect_episode_data()
        
        # 2. AI ë¦¬í¬íŠ¸ ìƒì„±
        print("\n2. AI ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...")
        report = self.generate_report(collected_data)
        
        # 3. ë¦¬í¬íŠ¸ ì €ì¥
        print("\n3. ë¦¬í¬íŠ¸ ì €ì¥ ì¤‘...")
        output_path = self.save_report(report)
        
        print(f"\n=== ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ ===")
        print(f"ğŸ“„ AI ë¦¬í¬íŠ¸: {output_path}")
        
        return output_path


def parse_episode_range(episode_range):
    """ì—í”¼ì†Œë“œ ë²”ìœ„ ë¬¸ìì—´ì„ íŒŒì‹±í•˜ì—¬ ì‹œì‘ê³¼ ë ë²ˆí˜¸ë¥¼ ë°˜í™˜"""
    try:
        if '-' in episode_range:
            start, end = episode_range.split('-')
            return int(start), int(end)
        else:
            # ë‹¨ì¼ ì—í”¼ì†Œë“œì¸ ê²½ìš°
            num = int(episode_range)
            return num, num
    except ValueError:
        return None, None

def find_previous_episode_range(project_uuid, current_episode_range):
    """í˜„ì¬ ì—í”¼ì†Œë“œ ë²”ìœ„ ì´ì „ì˜ ê°€ì¥ ìµœê·¼ ì—í”¼ì†Œë“œ ë²”ìœ„ë¥¼ ì°¾ê¸°"""
    import os
    
    base_data_dir = "../data"
    project_dir = os.path.join(base_data_dir, project_uuid)
    
    if not os.path.exists(project_dir):
        return None
    
    # í˜„ì¬ ì—í”¼ì†Œë“œ ë²”ìœ„ íŒŒì‹±
    current_start, current_end = parse_episode_range(current_episode_range)
    if current_start is None:
        return None
    
    # í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ë‚´ì˜ ëª¨ë“  ì—í”¼ì†Œë“œ ë²”ìœ„ ë””ë ‰í† ë¦¬ ì°¾ê¸°
    episode_ranges = []
    for item in os.listdir(project_dir):
        item_path = os.path.join(project_dir, item)
        if os.path.isdir(item_path):
            start, end = parse_episode_range(item)
            if start is not None and end is not None:
                # í˜„ì¬ ë²”ìœ„ë³´ë‹¤ ì´ì „ì¸ ê²ƒë§Œ ì¶”ê°€
                if end < current_start:
                    episode_ranges.append((item, start, end))
    
    if not episode_ranges:
        return None
    
    # ê°€ì¥ ìµœê·¼(ë ë²ˆí˜¸ê°€ ê°€ì¥ í°) ì´ì „ ë²”ìœ„ ì°¾ê¸°
    episode_ranges.sort(key=lambda x: x[2], reverse=True)  # end ë²ˆí˜¸ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    previous_range = episode_ranges[0][0]  # ë””ë ‰í† ë¦¬ ì´ë¦„ ë°˜í™˜
    
    print(f"ğŸ” ì´ì „ ì—í”¼ì†Œë“œ ë²”ìœ„ ë°œê²¬: {previous_range}")
    return previous_range

def find_previous_comprehensive_report(project_uuid, current_episode_range):
    """ì´ì „ ì—í”¼ì†Œë“œ ë²”ìœ„ì˜ comprehensive_report.txt íŒŒì¼ ê²½ë¡œ ì°¾ê¸°"""
    import os
    
    previous_range = find_previous_episode_range(project_uuid, current_episode_range)
    if not previous_range:
        print("ğŸ“‹ ì´ì „ ì—í”¼ì†Œë“œ ë²”ìœ„ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í”¼ë“œë°±ì„ ìƒì„±í•©ë‹ˆë‹¤.")
        return None
    
    # ì´ì „ ë²”ìœ„ì˜ comprehensive_report.txt ê²½ë¡œ êµ¬ì„±
    base_data_dir = "../data"
    report_path = os.path.join(base_data_dir, project_uuid, previous_range, "preprocessed", "comprehensive_report.txt")
    
    if os.path.exists(report_path):
        print(f"ğŸ“„ ì´ì „ í”¼ë“œë°± íŒŒì¼ ë°œê²¬: {report_path}")
        return report_path
    else:
        print(f"âš ï¸ ì´ì „ í”¼ë“œë°± íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: {report_path}")
        return None

def find_preprocessed_directory(project_uuid, episode_number):
    """project_uuidì™€ episode_numberë¥¼ ê¸°ë°˜ìœ¼ë¡œ preprocessed ë””ë ‰í† ë¦¬ ê²½ë¡œ ì°¾ê¸°"""
    import os
    
    # ê¸°ë³¸ data ë””ë ‰í† ë¦¬ ê²½ë¡œ (ìƒëŒ€ê²½ë¡œ)
    base_data_dir = "../data"
    project_dir = os.path.join(base_data_dir, project_uuid)
    
    if not os.path.exists(project_dir):
        print(f"âŒ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {project_dir}")
        return None
    
    # episode_number ë””ë ‰í† ë¦¬ ì°¾ê¸°
    episode_dir = os.path.join(project_dir, episode_number)
    if not os.path.exists(episode_dir):
        print(f"âŒ ì—í”¼ì†Œë“œ ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {episode_dir}")
        return None
    
    # preprocessed ë””ë ‰í† ë¦¬ ì°¾ê¸°
    preprocessed_dir = os.path.join(episode_dir, "preprocessed")
    if not os.path.exists(preprocessed_dir):
        print(f"âŒ preprocessed ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {preprocessed_dir}")
        return None
    
    return preprocessed_dir

def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    import sys
    
    # ëª…ë ¹í–‰ ì¸ì í™•ì¸
    if len(sys.argv) != 3:
        print("âŒ ì‚¬ìš©ë²•: python3 7_comprehensive_report_generator.py <project_uuid> <episode_number>")
        return 1
    
    project_uuid = sys.argv[1]
    episode_number = sys.argv[2]
    
    print(f"ğŸ” í”„ë¡œì íŠ¸ UUID: {project_uuid}")
    print(f"ğŸ” ì—í”¼ì†Œë“œ ë²ˆí˜¸: {episode_number}")
    
    # preprocessed ë””ë ‰í† ë¦¬ ìë™ ê²€ìƒ‰
    base_path = find_preprocessed_directory(project_uuid, episode_number)
    if not base_path:
        return 1
    
    print(f"ğŸ“ ê¸°ë³¸ ê²½ë¡œ: {base_path}")
    
    # ì´ì „ ì—í”¼ì†Œë“œ ë²”ìœ„ì˜ ì¢…í•© í”¼ë“œë°± íŒŒì¼ ìë™ ê²€ìƒ‰
    previous_feedback_path = find_previous_comprehensive_report(project_uuid, episode_number)
    
    try:
        # ë¦¬í¬íŠ¸ ìƒì„±ê¸° ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        generator = ComprehensiveReportGenerator(base_path, previous_feedback_path)
        
        if generator.has_previous_feedback:
            print(f"ğŸ“„ ê¸°ì¡´ í”¼ë“œë°± íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤: {previous_feedback_path}")
        else:
            print("ğŸ†• ìƒˆë¡œìš´ í”¼ë“œë°±ì„ ìƒì„±í•©ë‹ˆë‹¤.")
        
        # ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±
        output_path = generator.generate_comprehensive_report()
        
        print(f"\nâœ… ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
        print(f"ğŸ“„ ë¦¬í¬íŠ¸ íŒŒì¼: {output_path}")
        
    except Exception as e:
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
        return 1
    
    return 0


if __name__ == "__main__":
    exit(main())
